/*!
 * tTooltip v0.1
 *
 * Copyright 2012 Takien, No Inc
 * http://takien.com
 * 
 * Licensed under the Apache License v2.0
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * follow @cektkp and @perdanaweb
 */
(function(e){function t(t){var n=t.position();var r=n.top-e(window).scrollTop();var i=n.left-e(window).scrollLeft();var s=e(window).width()-(i+t.width());var o=e(window).height()-(r+t.height());var u="topleft";if(r>o){u="bottom"}else{u="top"}if(i>s){u+="right"}else{u+="left"}return u}e.fn.ttooltip=function(n){var r=e.extend({},e.fn.ttooltip.defaultOptions,n);var i=e(r.template);var s=i.find(".ttooltip-content");var o=i.find(".ttooltip-title");var u=i.find(".ttooltip-footer");var a=0;var f=0;var l;var c;i.css({position:"absolute","max-width":r.maxwidth});return this.each(function(n){var l=e(this);l.bind(r.trigger,function(n){function m(e){e.bind(r.close,function(){f++;if(f==1){a=setTimeout(function(){g(i)},r.timeout);i.bind("mouseenter",function(){f=0;clearTimeout(a)});l.bind("mouseenter",function(){f=0;clearTimeout(a)})}})}function g(e){e.fadeOut(r.fadeoutspeed,function(){e.remove();r.onclose(e,l)});clearTimeout(a);f=0}clearInterval(a);i.appendTo(document.body);i=e(".ttooltip-wrap");s=i.find(".ttooltip-content");o=i.find(".ttooltip-title");u=i.find(".ttooltip-footer");c=l.data();if(c.href==undefined){c.href=l.attr("href")}if(c.content==undefined){return false}if(c.content=="ajax"){e.get(c.href,function(e){i.find(".ttooltip-inner").html(e);r.onload(i,l)})}else{o.show().html(c.title);s.show().html(c.content);u.show().html(c.footer);r.onload(i,l);if(c.footer==undefined){u.empty().hide()}if(c.title==undefined){o.empty().hide()}}s.addClass("clearfix");u.addClass("clearfix");i.removeClass().addClass("ttooltip-wrap ttooltip-"+t(l)).fadeIn();var h=i.find(".ttooltip-arrow");var p=n.pageX-(h.outerWidth()*.5+h.position().left);var d=25;var v;p=p-d;h.removeClass("tooltip-arrow-gray");v=l.offset().top+l.outerHeight()+h.outerHeight();if(t(l)=="bottomright"||t(l)=="bottomleft"){v=l.offset().top-i.outerHeight()-h.outerHeight();p=p-d;d=0;if(i.find(".ttooltip-footer").html()!=""){h.addClass("tooltip-arrow-gray")}}i.css({top:v,left:p,width:c.width?c.width:"auto",opacity:1}).fadeIn();if(r.followmouse){e(this).mousemove(function(e){i.css({top:v,left:e.pageX-h.position().left-d})})}if(r.autohide){m(e(this));m(i)}if(r.closeonesc){document.onkeydown=function(e){e=e||window.event;if(e.keyCode==27){g(i)}}}i.find(".close").click(function(e){g(i);e.preventDefault()});n.preventDefault()})})};e.fn.ttooltip.defaultOptions={autohide:true,followmouse:true,closeonesc:true,content:"",title:"",trigger:"mouseenter",close:"mouseleave",maxwidth:300,timeout:500,fadeoutspeed:"fast",onload:function(){},onclose:function(){},template:'<div class="ttooltip-wrap"><div class="ttooltip-arrow ttooltip-arrow-border"></div><div class="ttooltip-arrow"></div><div class="ttooltip-inner"><button type="button" class="close">×</button><h3 class="ttooltip-title"></h3><div class="ttooltip-content"><p></p></div><div class="ttooltip-footer"></div></div></div>'}})(jQuery);